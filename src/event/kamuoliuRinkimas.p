new Float: kamPos[132][3] =
{
	{ -1424.347778, 2167.221679, 48.590000 },
	{ -1439.728637, 2158.104980, 47.580001 },
	{ -1524.085693, 2108.111572, 48.889999 },
	{ -1474.392944, 2002.262573, 46.909999 },
	{ -1175.345703, 1877.597900, 60.450000 },
	{ -873.263122, 1850.327026, 63.970001 },
	{ -846.857788, 1875.223144, 21.920000 },
	{ -841.533630, 1977.617675, 21.920000 },
	{ -738.835083, 1627.708862, 26.110000 },
	{ -798.902770, 1516.105468, 25.819999 },
	{ -784.512023, 1503.138671, 28.100000 },
	{ -777.217590, 1476.159545, 27.659999 },
	{ -829.120422, 1440.810791, 15.859999 },
	{ -853.523498, 1219.218994, 34.900001 },
	{ -790.608825, 1069.111938, 40.790000 },
	{ -638.135986, 948.275207, 10.479999 },
	{ -666.478088, 877.969604, 1.000000 },
	{ -765.779907, 716.646179, 17.180000 },
	{ -399.058288, 592.277587, 15.789999 },
	{ -386.351989, 692.958984, 26.319999 },
	{ -342.721801, 763.105285, 29.399999 },
	{ 28.513700, 832.619812, 36.290000 },
	{ 315.832702, 1051.402954, 23.260000 },
	{ 573.941772, 1291.948852, 9.090000 },
	{ 855.877319, 1525.399169, 19.809999 },
	{ 874.051574, 1818.718994, 9.819999 },
	{ 914.577087, 2035.708374, 9.819999 },
	{ 999.893188, 2210.146728, 9.819999 },
	{ 1018.259216, 2378.832275, 9.819999 },
	{ 1175.384521, 2399.655029, 9.430000 },
	{ 1236.523437, 2653.604736, 9.819999 },
	{ 1388.564575, 2698.157226, 9.819999 },
	{ 1803.114501, 1450.918212, 12.810000 },
	{ 2054.795410, 1260.874267, 9.670000 },
	{ 1988.454711, 360.485809, 25.530000 },
	{ 1956.089355, 185.642395, 33.060001 },
	{ 2213.354736, 14.202199, 23.729999 },
	{ 2265.933593, -0.846599, 31.530000 },
	{ 2355.569091, -4.346799, 26.819999 },
	{ 2438.242187, 26.212900, 25.989999 },
	{ 2555.144531, 77.856498, 25.469999 },
	{ 2644.178710, 67.888801, 25.989999 },
	{ 2669.718261, 73.318000, 32.040000 },
	{ 2715.287841, 137.265396, 36.490001 },
	{ 2710.589111, 213.247604, 53.889999 },
	{ 2630.402099, 232.915893, 57.959999 },
	{ 2628.826416, -343.545288, 55.560001 },
	{ 2689.102539, -777.011291, 79.360000 },
	{ 2611.947998, -1021.284729, 74.800003 },
	{ 2598.125732, -1110.931152, 66.730003 },
	{ 2599.947998, -1176.163574, 61.770000 },
	{ 2574.304687, -1354.514770, 34.169998 },
	{ 2589.460937, -1505.140258, 14.720000 },
	{ 2791.384277, -1679.558837, 8.880000 },
	{ 2898.454345, -1968.022827, 2.559999 },
	{ 2701.431396, -2389.856689, 12.630000 },
	{ 2264.015625, -2681.343017, 12.550000 },
	{ 1980.112548, -2625.051513, 12.539999 },
	{ 1464.692016, -2450.938476, 12.550000 },
	{ 1315.998901, -2429.488281, 8.500000 },
	{ 1042.323364, -2331.661865, 12.050000 },
	{ 991.598388, -2157.907470, 12.090000 },
	{ 993.933898, -1937.463623, 7.119999 },
	{ 906.777099, -1890.286254, 1.629999 },
	{ 820.847473, -1877.369384, 11.859999 },
	{ 620.275573, -1856.217895, 4.369999 },
	{ 470.108795, -1879.565551, 1.879999 },
	{ 378.250488, -2020.133056, 6.829999 },
	{ 194.702194, -1834.088500, 2.869999 },
	{ 134.515502, -1762.377197, 4.190000 },
	{ -12.412400, -1480.171264, 3.019999 },
	{ -115.184700, -1522.995361, 2.109999 },
	{ -220.998901, -1679.599731, 3.549999 },
	{ -388.076293, -1704.576660, 16.649999 },
	{ -597.037475, -1689.247314, 42.229999 },
	{ -683.185119, -1436.132080, 61.630001 },
	{ -809.948974, -1276.693359, 77.269996 },
	{ -835.200073, -1332.681152, 104.099998 },
	{ -874.367919, -1456.330566, 111.470001 },
	{ -908.939880, -1502.251098, 121.910003 },
	{ -1051.137084, -1618.702636, 75.370002 },
	{ -1184.388916, -1685.459960, 87.260002 },
	{ -1358.564575, -1841.014770, 3.250000 },
	{ -1592.131713, -1948.926147, 94.500000 },
	{ -2275.138427, -2250.104248, 26.860000 },
	{ -2232.403076, -2301.787597, 29.590000 },
	{ -1960.293945, -2453.004882, 29.620000 },
	{ -2622.512207, -2393.060546, 14.420000 },
	{ -2578.505615, -2673.148193, 6.880000 },
	{ -2355.204833, -2779.690429, 9.000000 },
	{ -2792.178955, -853.815429, 25.280000 },
	{ -2921.115722, -765.601806, 11.859999 },
	{ -2899.810546, -597.020080, 5.920000 },
	{ -2861.658935, -357.005187, 13.220000 },
	{ -2895.608398, -171.045593, 3.059999 },
	{ -2853.332031, 97.692199, 10.710000 },
	{ -2928.418701, 358.376586, 1.570000 },
	{ -2935.909667, 693.021789, 7.050000 },
	{ -2924.936035, 983.086181, 5.230000 },
	{ -2871.406250, 1239.943237, 6.099999 },
	{ -2803.700195, 1308.567749, 6.099999 },
	{ -2685.126953, 1477.343872, 55.459999 },
	{ -1502.891601, 676.826721, 6.179999 },
	{ -1698.043945, 271.921203, 6.179999 },
	{ -1758.508178, 116.629501, 3.210000 },
	{ -1585.622558, -279.758087, 13.140000 },
	{ -1508.776855, -427.744110, 5.869999 },
	{ -1668.106079, -585.550415, 13.140000 },
	{ -1777.994140, -626.770812, 17.420000 },
	{ -1966.676879, -704.807922, 31.159999 },
	{ -2133.500976, -734.984619, 31.170000 },
	{ -2221.422607, -765.491821, 63.150001 },
	{ -2316.645263, -814.839172, 58.270000 },
	{ -2692.602539, -659.893676, 63.819999 },
	{ -2657.218261, -179.857299, 3.059999 },
	{ -2694.821533, 115.919197, 3.329999 },
	{ -2695.141113, 188.892807, 3.329999 },
	{ -2692.322509, 350.146789, 3.710000 },
	{ -2720.093261, 396.962890, 3.660000 },
	{ -2654.859863, 760.417785, 36.450000 },
	{ -2720.719970, 741.196411, 38.889999 },
	{ -2493.240722, 749.661376, 34.169998 },
	{ -2419.598388, 753.153198, 34.169998 },
	{ -2025.206542, 667.955078, 45.610000 },
	{ -1976.239746, -113.972503, 29.180000 },
	{ -1969.706542, 27.403499, 31.159999 },
	{ -1883.051879, 127.528099, 37.189998 },
	{ -1930.553100, -217.102706, 37.159999 },
	{ -1925.260864, -284.371093, 37.009998 },
	{ -1985.329589, -620.738403, 36.259998 },
	{ -2030.184082, -983.033020, 31.170000 },
	{ -2185.492675, -976.091125, 36.069999 }
};

new kamInServ[40][3]; // 0 - kamPos id; 1 - objecto id; 2 - text3d lab id;

#include YSI\y_hooks

forward kraunakamuolius();
CMD:pazkam(playerid, param[])
{
    if(zInfo[playerid][admin] < 5) return 0;
	new k = strval(param);

	SetPlayerMapIcon(playerid, 80, kamPos[kamInServ[k][0]][0], kamPos[kamInServ[k][0]][1], kamPos[kamInServ[k][0]][2], 0, 946881535, MAPICON_GLOBAL_CHECKPOINT);

	return 1;
}

// reskam pazkam

CMD:reskam(playerid, param[])
{
	if(zInfo[playerid][admin] < 5) return 0;
	resetKamuoliai();
	zInfo[playerid][kamuoliai] = 0;
	mysql_query("UPDATE `zaidejai` SET `Kamuoliai` = '0'");
	return 1;
}

CMD:kamtop(playerid, prm[])
{
	new x, str[330], strf[1100];
    mysql_query("SELECT vardas, Kamuoliai FROM zaidejai WHERE Kamuoliai > 0 ORDER BY Kamuoliai DESC LIMIT 5");
    mysql_store_result();

    if (!mysql_num_rows())
    {
    	SendClientMessage(playerid, RED, "Ðiandien dar niekas nerado bent vieno kamuolio");
    	mysql_free_result ();
    	return 1;
    }

    while(mysql_retrieve_row())
    {
    	new pName[MAX_PLAYER_NAME], kamCount;
    	x ++;
    	mysql_fetch_field_row(pName, "Kamuoliai");
    	kamCount = strval(pName);
    	mysql_fetch_field_row(pName, "vardas");
    	format(str, 120, "{FFFFFF}%d. {ffffcc}%s {FFFFFF}turintis {ffffcc}%d {FFFFFF}kamuoliø\n", x, pName, kamCount); strcat(strf, str);
    }
    format(str, 210, "\n\n{EB3232}Kamuoliø laimëtojas skelbiamas kiekvienà dienà 23:59.\nKamuoliø nugalëtojas gaus random (patirties taðkø, serverio pinigø, serverio kreditø)."); strcat(strf, str);
   	ShowPlayerDialogEx(playerid, 0, DIALOG_STYLE_MSGBOX, "TOP KAMUOLIØ RINKËJØ", strf, "Aiðku", "");
    mysql_free_result();
	return 1;
}

CMD:kamuoliai(playerid, params[])
{
	new zx[40];
	format (zx, sizeof zx, "Tu esi surinkæs %d kamuoliø", get_PlayerKamCount(playerid));
	SendClientMessage(playerid, YELLOW, zx);
	return 1;
}

hook OnGameModeInit()
{
    SetTimer("kraunakamuolius", 1000*60*5, true);
	return 1;
}

hook OnPlayerKeyStateChange(playerid, newkeys, oldkeys)
{
	if (newkeys & KEY_WALK)
	{
		if (IsPlayerInAnyVehicle(playerid)) return 1;

		for (new i; i < sizeof kamInServ; i++)
		{
			if (kamInServ[i][1] == INVALID_OBJECT_ID) continue;

			if (IsPlayerInRangeOfPoint(playerid, 2.0, kamPos[kamInServ[i][0]][0], kamPos[kamInServ[i][0]][1], kamPos[kamInServ[i][0]][2]))
			{
                zInfo[playerid][kamuoliai] ++;
				new zx[95];
				format (zx, sizeof zx, "UPDATE zaidejai SET Kamuoliai = '%d' WHERE vardas = '%s'", zInfo[playerid][kamuoliai], GetPlayerNameEx(playerid));
				mysql_query (zx);
				format (zx, sizeof zx, "Radai kamuolá, sveikinu! Dabar turi %d kamuoliø. Kamuoliø TOP - /kamtop", get_PlayerKamCount(playerid));
				SendClientMessage(playerid, GREEN, zx);
				SendClientMessage(playerid, YELLOW, "[PRIMINIMAS] Kiek esi surinkæs kamuoliø gali suþinoti su /kamuoliai");

				DestroyDynamicObject (kamInServ[i][1]);
				DestroyDynamic3DTextLabel(Text3D:kamInServ[i][2]);
				kamInServ[i][1] = INVALID_OBJECT_ID;
				kamInServ[i][2] = INVALID_3DTEXT_ID;
				RemovePlayerMapIcon(i, 80);

				break;
			}
		}
	}

	return 1;
}

get_PlayerKamCount (playerid)
{
	new zx[80];
	format(zx, sizeof zx, "SELECT Kamuoliai FROM zaidejai WHERE vardas = '%s'", GetPlayerNameEx(playerid));
	mysql_query(zx);
	mysql_store_result();
	new howMuch = mysql_fetch_int();
	mysql_free_result();
	return howMuch;
}

resetKamuoliai ()
{
	new str[120];
    mysql_query("SELECT vardas, Kamuoliai FROM zaidejai ORDER BY Kamuoliai DESC LIMIT 1");
    mysql_store_result();

    if (!mysql_num_rows())
    {
    	SendClientMessageToAll(YELLOW, "> Ðiandien niekas nerado nei vieno kamuolio, todël prizas lieka prizø fonde.");
    	SendClientMessageToAll(YELLOW, "> Nuo dabar vël galite ieðkoti kamuoliø, bet paskubëkite jø pasislëpusiu tik 40.");
    	mysql_free_result();
    	return 1;
    }

    mysql_retrieve_row();

    new pName[MAX_PLAYER_NAME], kamCount;
    mysql_fetch_field_row(pName, "Kamuoliai");
    kamCount = strval(pName);
    mysql_fetch_field_row(pName, "vardas");
    mysql_free_result();
    
    new prizType[10], prizCount;

    switch (random(10))
    {
    	case 0, 1, 2, 3:
    	{
    		prizCount = random(200) + 500;
    		prizType = "patirties";
    		giveXp(pName, prizCount);
    	}
    	case 4, 5, 6, 7:
    	{
    		prizCount = random(1000) + 8000;
    		prizType = "pinigø";
    		giveMony(pName, prizCount);
    	}
    	case 8, 9:
    	{
    		prizCount = random(50) + 50;
    		prizType = "kreditø";
    		giveKred(pName, prizCount);
    	}
    }

    format (str, sizeof str, "> Ðiandien daugiausiai kamuoliø surado %s. Þaidëjas surado %d kamuoliø ir uþ tai gavo %d %s", pName, kamCount, prizCount, prizType);
    SendClientMessageToAll(YELLOW, str);
    SendClientMessageToAll(YELLOW, "> Nuo dabar vël galite ieðkoti kamuoliø, bet paskubëkite jø pasislëpusiu tik 40");

    //zInfo[playerid][kamuoliai] = 0;

    new bool: blackKamPos[sizeof kamPos];

    for (new i; i < sizeof kamInServ; i++)
	{
		if (kamInServ[i][1] != INVALID_OBJECT_ID)
		{
			DestroyDynamicObject (kamInServ[i][1]);
			DestroyDynamic3DTextLabel(Text3D:kamInServ[i][2]);
		}

		new index;
		do
		{
			index = random(sizeof kamPos);
		}
		while (blackKamPos[index]);

		blackKamPos[index] = true;
		
		kamInServ[i][0] = index;
		kamInServ[i][1] = CreateDynamicObject(3065, kamPos[index][0], kamPos[index][1], kamPos[index][2], 0.0, 0.0, 0.0);
		kamInServ[i][2] = _:CreateDynamic3DTextLabel("Kamuolys\nSpausk LALT", -1, kamPos[index][0], kamPos[index][1], kamPos[index][2], 3.0);
	}

	return 1;
}

giveKred (name[MAX_PLAYER_NAME], kredCount)
{
	new pid = GetPlayerIdFromName(name);

	new zx[100];

	if (pid == INVALID_PLAYER_ID)
	{
		format (zx, sizeof zx, "UPDATE zaidejai SET kreditai = kreditai + %d WHERE vardas = '%s'", kredCount, name);
		mysql_query (zx);
	}
	else
	{
		zInfo[pid][kreditai] += kredCount;
		format (zx, sizeof zx, "[INFO] Gavote %d kreditø", kredCount);
		SendClientMessage(pid, ORANGE, zx);
	}
	return 1;
}

giveMony (name[MAX_PLAYER_NAME], monCount)
{
	new pid = GetPlayerIdFromName(name);

	new zx[100];

	if (pid == INVALID_PLAYER_ID)
	{
		format (zx, sizeof zx, "UPDATE zaidejai SET pinigai = pinigai + %d WHERE vardas = '%s'", monCount, name);
		mysql_query (zx);
	}
	else
	{
		GivePlayerMoneyA(pid, monCount);
		format (zx, sizeof zx, "[INFO] Gavote %d pinigø", monCount);
		SendClientMessage(pid, ORANGE, zx);
	}
	return 1;
}

giveXp (name[MAX_PLAYER_NAME], xpCount)
{
	new pid = GetPlayerIdFromName(name);

	new zx[100];

	if (pid == INVALID_PLAYER_ID)
	{
		format (zx, sizeof zx, "UPDATE zaidejai SET patirtis = patirtis + %d WHERE vardas = '%s'", xpCount, name);
		mysql_query (zx);
	}
	else
	{
		SetPlayerScore(pid, GetPlayerScore(pid) +xpCount);
		format (zx, sizeof zx, "[INFO] Gavote %d patirties", xpCount);
		SendClientMessage(pid, ORANGE, zx);
	}
	return 1;
}

public kraunakamuolius()
{
    new bool: blackKamPos[sizeof kamPos];

	for (new i; i < sizeof kamInServ; i++)
	{
		new index;
		do
		{
			index = random(sizeof kamPos);
		}
		while (blackKamPos[index]);
		
		blackKamPos[index] = true;
		kamInServ[i][0] = index;
		kamInServ[i][1] = CreateDynamicObject(3065, kamPos[index][0], kamPos[index][1], kamPos[index][2], 0.0, 0.0, 0.0);
		kamInServ[i][2] = _:CreateDynamic3DTextLabel("Kamuolys\nSpausk LALT", -1, kamPos[index][0], kamPos[index][1], kamPos[index][2], 3.0);
	    SendClientMessage(i, YELLOW, "MINI-MAP atsirado þalias checkpoint skubëkite paimti kamuolá!");
		SetPlayerMapIcon(i, 80, kamPos[kamInServ[i][0]][0], kamPos[kamInServ[i][0]][1], kamPos[kamInServ[i][0]][2], 0, 946881535, MAPICON_GLOBAL_CHECKPOINT);
	} 
}
